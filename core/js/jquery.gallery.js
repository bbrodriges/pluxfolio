$(function(){$.fn.imagesLoaded=function(a){function g(){if(--c<=0&&this.src!==e){setTimeout(f);b.unbind("load error",g)}}function f(){a.call(d,b)}var b=this.find("img"),c=b.length,d=this,e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";if(!c){f()}b.bind("load error",g).each(function(){if(this.complete||this.complete===undefined){var a=this.src;this.src=e;this.src=a}});return this};var a=$("#rg-gallery"),b=a.find("div.es-carousel-wrapper"),c=b.find("ul > li"),d=c.length;Gallery=function(){var e=0,f="carousel",g=false,h=function(){c.add('<img src="images/ajax-loader.gif"/><img src="images/black.png"/>').imagesLoaded(function(){j();k();m(c.eq(e))});i()},i=function(){b.show().elastislide({imageW:65,onClick:function(a){if(g)return false;g=true;m(a);e=a.index()}});b.elastislide("setCurrent",e)},j=function(){var c=$('<a href="#" class="rg-view-full"></a>'),d=$('<a href="#" class="rg-view-thumbs rg-view-selected"></a>');a.prepend($('<div class="rg-view"/>').append(c).append(d));c.bind("click.rgGallery",function(a){b.elastislide("destroy").hide();c.addClass("rg-view-selected");d.removeClass("rg-view-selected");f="fullview";return false});d.bind("click.rgGallery",function(a){i();d.addClass("rg-view-selected");c.removeClass("rg-view-selected");f="carousel";return false})},k=function(){$("#img-wrapper-tmpl").tmpl({itemsCount:d}).appendTo(a);if(d>1){var b=a.find("a.rg-image-nav-prev"),c=a.find("a.rg-image-nav-next"),e=a.find("div.rg-image");b.bind("click.rgGallery",function(a){l("left");return false});c.bind("click.rgGallery",function(a){l("right");return false});e.touchwipe({wipeLeft:function(){l("right")},wipeRight:function(){l("left")},preventDefaultEvents:false});$(document).bind("keyup.rgGallery",function(a){if(a.keyCode==39)l("right");else if(a.keyCode==37)l("left")})}},l=function(a){if(g)return false;g=true;if(a==="right"){if(e+1>=d)e=0;else++e}else if(a==="left"){if(e-1<0)e=d-1;else--e}m(c.eq(e))},m=function(d){var h=a.find("div.rg-loading").show();c.removeClass("selected");d.addClass("selected");var i=d.find("img"),j=i.data("large"),k=i.data("description");$("<img/>").load(function(){a.find("div.rg-image").empty().append('<img src="'+j+'"/>');if(k)a.find("div.rg-caption").show().children("p").empty().text(k);h.hide();if(f==="carousel"){b.elastislide("reload");b.elastislide("setCurrent",e)}g=false}).attr("src",j)};return{init:h}}();Gallery.init()})